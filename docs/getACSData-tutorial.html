<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Census Data Wrangling | Opioid-Environment-Toolkit.utf8</title>
  <meta name="description" content="<span style='color: #982568; font-size:42px'>Opioid Environment Toolkit
</style>" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Census Data Wrangling | Opioid-Environment-Toolkit.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Census Data Wrangling | Opioid-Environment-Toolkit.utf8" />
  
  
  

<meta name="author" content="Developed for the JCOIN Network of the NIH HEAL Initiative. Last Updated : 2020-10-08" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="link-contextual-data.html"/>
<link rel="next" href="visualizeArealData-tutorial.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-basics"><i class="fa fa-check"></i>Software Basics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#author-team"><i class="fa fa-check"></i>Author Team</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html"><i class="fa fa-check"></i><b>1</b> Spatial Data Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-spatial-data"><i class="fa fa-check"></i><b>1.1</b> Defining spatial data</a></li>
<li class="chapter" data-level="1.2" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-vector-data"><i class="fa fa-check"></i><b>1.2</b> Spatial data formats</a><ul>
<li class="chapter" data-level="1.2.1" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#simple-features"><i class="fa fa-check"></i><b>1.2.1</b> Simple features</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#spatial-data-types"><i class="fa fa-check"></i><b>1.3</b> Spatial data types</a></li>
<li class="chapter" data-level="1.4" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-crs"><i class="fa fa-check"></i><b>1.4</b> Coordinate Reference System</a></li>
<li class="chapter" data-level="" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-appendix"><i class="fa fa-check"></i>Further resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html"><i class="fa fa-check"></i><b>2</b> Geocoding Resource Locations</a><ul>
<li class="chapter" data-level="2.1" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-research-question"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-setup"><i class="fa fa-check"></i><b>2.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="2.2.1" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-i-o"><i class="fa fa-check"></i><b>2.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="2.2.2" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-packages1"><i class="fa fa-check"></i><b>2.2.2</b> Load Libraries</a></li>
<li class="chapter" data-level="2.2.3" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#load-data"><i class="fa fa-check"></i><b>2.2.3</b> Load Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-geocode-addresses"><i class="fa fa-check"></i><b>2.3</b> Geocode addresses</a><ul>
<li class="chapter" data-level="2.3.1" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#quality-control"><i class="fa fa-check"></i><b>2.3.1</b> Quality Control</a></li>
<li class="chapter" data-level="2.3.2" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#selecting-geocoding-service"><i class="fa fa-check"></i><b>2.3.2</b> Selecting Geocoding Service</a></li>
<li class="chapter" data-level="2.3.3" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#test-geocoding-service"><i class="fa fa-check"></i><b>2.3.3</b> Test Geocoding Service</a></li>
<li class="chapter" data-level="2.3.4" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#prepare-input-parameter"><i class="fa fa-check"></i><b>2.3.4</b> Prepare input parameter</a></li>
<li class="chapter" data-level="2.3.5" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#batch-geocoding"><i class="fa fa-check"></i><b>2.3.5</b> Batch Geocoding</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#GA-spatial-dataframe"><i class="fa fa-check"></i><b>2.4</b> Convert to Spatial Data</a><ul>
<li class="chapter" data-level="2.4.1" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#spatial-reference-systems"><i class="fa fa-check"></i><b>2.4.1</b> Spatial Reference Systems</a></li>
<li class="chapter" data-level="2.4.2" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#enable-points"><i class="fa fa-check"></i><b>2.4.2</b> Enable Points</a></li>
<li class="chapter" data-level="2.4.3" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#visualize-points"><i class="fa fa-check"></i><b>2.4.3</b> Visualize Points</a></li>
<li class="chapter" data-level="2.4.4" data-path="geocodingAddress-tutorial.html"><a href="geocodingAddress-tutorial.html#convert-to-shapefile"><i class="fa fa-check"></i><b>2.4.4</b> Convert to Shapefile</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="buffer_analysis.html"><a href="buffer_analysis.html"><i class="fa fa-check"></i><b>3</b> Buffer Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#overview"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#environment-setup"><i class="fa fa-check"></i><b>3.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="3.2.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-i-o"><i class="fa fa-check"></i><b>3.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="3.2.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-lib"><i class="fa fa-check"></i><b>3.2.2</b> Load Libraries</a></li>
<li class="chapter" data-level="3.2.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-data"><i class="fa fa-check"></i><b>3.2.3</b> Load Data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#simple-overlay-map"><i class="fa fa-check"></i><b>3.3</b> Simple Overlay Map</a></li>
<li class="chapter" data-level="3.4" data-path="buffer_analysis.html"><a href="buffer_analysis.html#spatial-transformation"><i class="fa fa-check"></i><b>3.4</b> Spatial Transformation</a><ul>
<li class="chapter" data-level="3.4.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#transform-crs"><i class="fa fa-check"></i><b>3.4.1</b> Transform CRS</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="buffer_analysis.html"><a href="buffer_analysis.html#generate-buffers"><i class="fa fa-check"></i><b>3.5</b> Generate Buffers</a><ul>
<li class="chapter" data-level="3.5.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#visualize-buffers"><i class="fa fa-check"></i><b>3.5.1</b> Visualize buffers</a></li>
<li class="chapter" data-level="3.5.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#buffer-union"><i class="fa fa-check"></i><b>3.5.2</b> Buffer union</a></li>
<li class="chapter" data-level="3.5.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#save-data"><i class="fa fa-check"></i><b>3.5.3</b> Save Data</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="buffer_analysis.html"><a href="buffer_analysis.html#rinse-repeat"><i class="fa fa-check"></i><b>3.6</b> Rinse &amp; Repeat</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="link-contextual-data.html"><a href="link-contextual-data.html"><i class="fa fa-check"></i><b>4</b> Link Community Data</a><ul>
<li class="chapter" data-level="4.1" data-path="link-contextual-data.html"><a href="link-contextual-data.html#overview-1"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="link-contextual-data.html"><a href="link-contextual-data.html#environment-setup-1"><i class="fa fa-check"></i><b>4.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="4.2.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-i-o"><i class="fa fa-check"></i><b>4.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="4.2.2" data-path="link-contextual-data.html"><a href="link-contextual-data.html#load-libraries"><i class="fa fa-check"></i><b>4.2.2</b> Load Libraries</a></li>
<li class="chapter" data-level="4.2.3" data-path="link-contextual-data.html"><a href="link-contextual-data.html#load-data-1"><i class="fa fa-check"></i><b>4.2.3</b> Load data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="link-contextual-data.html"><a href="link-contextual-data.html#clean-merge-data"><i class="fa fa-check"></i><b>4.3</b> Clean &amp; Merge Data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="link-contextual-data.html"><a href="link-contextual-data.html#subset-data"><i class="fa fa-check"></i><b>4.3.1</b> Subset Data</a></li>
<li class="chapter" data-level="4.3.2" data-path="link-contextual-data.html"><a href="link-contextual-data.html#identify-geographic-key"><i class="fa fa-check"></i><b>4.3.2</b> Identify Geographic Key</a></li>
<li class="chapter" data-level="4.3.3" data-path="link-contextual-data.html"><a href="link-contextual-data.html#merge-data"><i class="fa fa-check"></i><b>4.3.3</b> Merge Data</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="link-contextual-data.html"><a href="link-contextual-data.html#visualize-data"><i class="fa fa-check"></i><b>4.4</b> Visualize Data</a></li>
<li class="chapter" data-level="4.5" data-path="link-contextual-data.html"><a href="link-contextual-data.html#save-data-1"><i class="fa fa-check"></i><b>4.5</b> Save Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html"><i class="fa fa-check"></i><b>5</b> Census Data Wrangling</a><ul>
<li class="chapter" data-level="5.1" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-research-question"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-setup"><i class="fa fa-check"></i><b>5.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="5.2.1" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-i-o"><i class="fa fa-check"></i><b>5.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="5.2.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-lib"><i class="fa fa-check"></i><b>5.2.2</b> Load Libraries</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-api-key"><i class="fa fa-check"></i><b>5.3</b> Enable Census API Key</a></li>
<li class="chapter" data-level="5.4" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-get-data"><i class="fa fa-check"></i><b>5.4</b> Load Data Dynamically</a><ul>
<li class="chapter" data-level="5.4.1" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#state-level"><i class="fa fa-check"></i><b>5.4.1</b> State Level</a></li>
<li class="chapter" data-level="5.4.2" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#county-level"><i class="fa fa-check"></i><b>5.4.2</b> County Level</a></li>
<li class="chapter" data-level="5.4.3" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#census-tract-level"><i class="fa fa-check"></i><b>5.4.3</b> Census Tract Level</a></li>
<li class="chapter" data-level="5.4.4" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#zipcode-level"><i class="fa fa-check"></i><b>5.4.4</b> Zipcode Level</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-get-geometry"><i class="fa fa-check"></i><b>5.5</b> Get Geometry</a><ul>
<li class="chapter" data-level="5.5.1" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#using-tigris"><i class="fa fa-check"></i><b>5.5.1</b> Using tigris</a></li>
<li class="chapter" data-level="5.5.2" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#using-tidycensus"><i class="fa fa-check"></i><b>5.5.2</b> Using tidycensus</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#save-data-2"><i class="fa fa-check"></i><b>5.6</b> Save Data</a></li>
<li class="chapter" data-level="5.7" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-appendix"><i class="fa fa-check"></i><b>5.7</b> Appendix</a><ul>
<li class="chapter" data-level="5.7.1" data-path="getACSData-tutorial.html"><a href="getACSData-tutorial.html#CD-explore-variables"><i class="fa fa-check"></i><b>5.7.1</b> Explore variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html"><i class="fa fa-check"></i><b>6</b> Thematic Mapping</a><ul>
<li class="chapter" data-level="6.1" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-research-question"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-setup"><i class="fa fa-check"></i><b>6.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="6.2.1" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-i-o"><i class="fa fa-check"></i><b>6.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="6.2.2" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-packages2"><i class="fa fa-check"></i><b>6.2.2</b> Load the packages</a></li>
<li class="chapter" data-level="6.2.3" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-load-variables"><i class="fa fa-check"></i><b>6.2.3</b> Load data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-mapping"><i class="fa fa-check"></i><b>6.3</b> Thematic Plotting</a><ul>
<li class="chapter" data-level="6.3.1" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-quantile-plot"><i class="fa fa-check"></i><b>6.3.1</b> Quantile</a></li>
<li class="chapter" data-level="6.3.2" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-jenks-plot"><i class="fa fa-check"></i><b>6.3.2</b> Natural Breaks</a></li>
<li class="chapter" data-level="6.3.3" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-stdev-plot"><i class="fa fa-check"></i><b>6.3.3</b> Standard Deviation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-appendix"><i class="fa fa-check"></i><b>6.4</b> Appendix</a><ul>
<li class="chapter" data-level="" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-set-palette"><i class="fa fa-check"></i>Set Color Palette</a></li>
<li class="chapter" data-level="" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-colorbrewer"><i class="fa fa-check"></i>Use ColorBrewer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html"><i class="fa fa-check"></i><b>7</b> Nearest Resource Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-research-question"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-setup"><i class="fa fa-check"></i><b>7.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="7.2.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-packages1"><i class="fa fa-check"></i><b>7.2.1</b> Packages used</a></li>
<li class="chapter" data-level="7.2.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-i-o"><i class="fa fa-check"></i><b>7.2.2</b> Input/Output</a></li>
<li class="chapter" data-level="7.2.3" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-packages2"><i class="fa fa-check"></i><b>7.2.3</b> Load the packages</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-read-resources"><i class="fa fa-check"></i><b>7.3</b> Load data</a></li>
<li class="chapter" data-level="7.4" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-calculate-centroids"><i class="fa fa-check"></i><b>7.4</b> Calculate centroids</a><ul>
<li class="chapter" data-level="7.4.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#visualize-confirm"><i class="fa fa-check"></i><b>7.4.1</b> Visualize &amp; Confirm</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-correct-projection"><i class="fa fa-check"></i><b>7.5</b> Standardize CRS</a></li>
<li class="chapter" data-level="7.6" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-distance"><i class="fa fa-check"></i><b>7.6</b> Calculate Distance</a><ul>
<li class="chapter" data-level="7.6.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#merge-data-1"><i class="fa fa-check"></i><b>7.6.1</b> Merge Data</a></li>
<li class="chapter" data-level="7.6.2" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#visualize-confirm-1"><i class="fa fa-check"></i><b>7.6.2</b> Visualize &amp; Confirm</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-save"><i class="fa fa-check"></i><b>7.7</b> Save Data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><span style='color: #982568; font-size:42px'>Opioid Environment Toolkit
</style></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="contextual-data" class="section level1">
<h1><span class="header-section-number">5</span> Census Data Wrangling</h1>
<div id="CD-research-question" class="section level2">
<h2><span class="header-section-number">5.1</span> Overview</h2>
<p>Once we identify the appropriate access metric to use, we can now include contextual data to add nuance to our findings. This can help identify if any specific disparities in access exist for certain groups of people or if there are any specific factors that can help explain the spatial patterns. Such datasets are often sourced from the <a href="https://data.census.gov">US Census Bureau</a>. The American Community Survey (ACS) is an ongoing survey that provides data every year with 1 and 5-year estimates. We generally recommend using the 5-year estimates as these multiperiod estimates tend to have increased statistical reliability as compared to the 1-year numbers, especially for less populated areas and small population subgroups.</p>
<p>In this tutorial we demonstrate how to explore and download most commonly used population datasets from the same, with and without spatial components. Please note this tutorial focuses <strong>only</strong> on the American Community Survey datasets available via the Census Bureau API. More details about using tidycensus, with tutorials generated by package authors, can be found <a href="https://walker-data.com/tidycensus/">here</a>.</p>
<p>Our objectives are to:</p>
<ul>
<li>Download census data through the Census API</li>
<li>Download census boundaries thorough the Census API</li>
<li>Wrangle, clean and merge data for further integration</li>
</ul>
</div>
<div id="CD-setup" class="section level2">
<h2><span class="header-section-number">5.2</span> Environment Setup</h2>
<p>To replicate the codes &amp; functions illustrated in this tutorial, you’ll need to have R and RStudio downloaded and installed on your system. This tutorial assumes some familiarity with the R programming language.</p>
<div id="CD-i-o" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Input/Output</h3>
<p>We will not be using an external input for this exercise.</p>
<p>Our output will be two sets of files:</p>
<ul>
<li>CSV file and shapefile with Race Data distributions at county level for the state of Illinois.</li>
<li>and CSV file and shapefile with Population and Per Capita Income for the zipcodes within the city of Chicago for 2018.</li>
</ul>
</div>
<div id="BA-lib" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Load Libraries</h3>
<p>We will use the following packages in this tutorial:</p>
<ul>
<li><code>sf</code>: to read/write sf (spatial) objects</li>
<li><code>tidycensus</code>: to download census variables using ACS API</li>
<li><code>tidyverse</code>: to manipulate and clean data</li>
<li><code>tigris</code> : to download census tiger shapefiles</li>
</ul>
<p>Load the required libraries.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw">library</span>(tidycensus)</a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="kw">library</span>(tigris)</a></code></pre></div>
</div>
</div>
<div id="CD-api-key" class="section level2">
<h2><span class="header-section-number">5.3</span> Enable Census API Key</h2>
<p>To be able to use the Census API, we need to signup for an API key. This key effectively is a string identifier for the server to communicate with your machine. A key can be obtained using an email from <a href="http://api.census.gov/data/key_signup.html">here</a>. Once we get the key, we can install it by running the code below.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="co">#census_api_key(&quot;yourkeyhere&quot;, install = TRUE) # installs the key for future sessions. </span></a></code></pre></div>
<p>In instances where we might not want to save our key in the .Renviron - for example, when using a shared computer, we can always reinstall the same key using the code above but with <code>install = FALSE</code>.</p>
<p>To check an already installed census API key, run</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="kw">Sys.getenv</span>(<span class="st">&quot;CENSUS_API_KEY&quot;</span>)</a></code></pre></div>
</div>
<div id="CD-get-data" class="section level2">
<h2><span class="header-section-number">5.4</span> Load Data Dynamically</h2>
<p>We can now start using the <em>tidycensus</em> package to download population based datasets from the US Census Bureau. In this tutorial, we will be covering methods to download data at the state, county, zip and census tract levels. We will also be covering methods to download the data with and without the geometry feature of the geographic entities.</p>
<p>To download a particular variable or table using tidycensus, we need the relevant variable ID, which one can check by reviewing the variables available via <code>load_variables()</code> function. For details on exploring the variables available via the <em>tidycensus</em> &amp; to get their identifiers, check the <a href="getACSData-tutorial.html#CD-explore-variables">Explore variables available</a> section in Appendix.</p>
<p>We can now download the variables using <code>get_acs()</code> function. Given ACS data is based of an annual sample, the datapoints are available as an estimate with a margin or error (moe). The package provides both values for any requested variable in the <strong>tidy</strong> format.</p>
<p>For the examples covered in this tutorial, the 4 main inputs for <code>get_acs()</code> function are:</p>
<ol style="list-style-type: lower-alpha">
<li><code>geography</code> - for what scale to source the data for <em>(state / county / tract / zcta)</em></li>
<li><code>variables</code> - character string or a vector of character strings of variable IDs to source</li>
<li><code>year</code> - the year to source the data for</li>
<li><code>geometry</code> - whether or not to include the geometry feature in the tibble. <em>(TRUE / FALSE)</em></li>
</ol>
<div id="state-level" class="section level3">
<h3><span class="header-section-number">5.4.1</span> State Level</h3>
<p>To get data for only a specific state, we can add <code>state = sampleStateName</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">stateDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;state&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>, </a>
<a class="sourceLine" id="cb86-2" data-line-number="2">                                                      <span class="dt">hispanic =</span><span class="st">&quot;B03003_003&quot;</span>, </a>
<a class="sourceLine" id="cb86-3" data-line-number="3">                                                      <span class="dt">notHispanic =</span> <span class="st">&quot;B03003_002&quot;</span>,</a>
<a class="sourceLine" id="cb86-4" data-line-number="4">                                                      <span class="dt">white =</span> <span class="st">&quot;B02001_002&quot;</span>, </a>
<a class="sourceLine" id="cb86-5" data-line-number="5">                                                      <span class="dt">afrAm =</span> <span class="st">&quot;B02001_003&quot;</span>, </a>
<a class="sourceLine" id="cb86-6" data-line-number="6">                                                      <span class="dt">asian =</span> <span class="st">&quot;B02001_005&quot;</span>),</a>
<a class="sourceLine" id="cb86-7" data-line-number="7">                   <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb86-8" data-line-number="8"><span class="kw">head</span>(stateDf)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   GEOID NAME    variable    estimate   moe
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
## 1 01    Alabama totPop18     4864680    NA
## 2 01    Alabama white        3317453  3345
## 3 01    Alabama afrAm        1293186  2745
## 4 01    Alabama asian          64609  1251
## 5 01    Alabama notHispanic  4661534   393
## 6 01    Alabama hispanic      203146   393</code></pre>
<p>As we can see the data is available in the <em>tidy</em> format. We can use other tools in the <code>tidyverse</code> universe to clean and manipulate it.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">stateDf &lt;-<span class="st"> </span>stateDf <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="st">            </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hispPr18  =</span> hispanic<span class="op">/</span>totPop18, <span class="dt">WhitePr18 =</span> white<span class="op">/</span>totPop18,</a>
<a class="sourceLine" id="cb88-5" data-line-number="5">                   <span class="dt">AfrAmPr18 =</span> afrAm<span class="op">/</span>totPop18, <span class="dt">AsianPr18 =</span> asian<span class="op">/</span>totPop18) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-6" data-line-number="6"><span class="st">            </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb88-7" data-line-number="7"></a>
<a class="sourceLine" id="cb88-8" data-line-number="8"><span class="kw">head</span>(stateDf)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   GEOID totPop18 hispPr18 WhitePr18 AfrAmPr18 AsianPr18
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 01     4864680   0.0418     0.682    0.266     0.0133
## 2 02      738516   0.0693     0.648    0.0327    0.0630
## 3 04     6946685   0.311      0.772    0.0439    0.0329
## 4 05     2990671   0.0732     0.770    0.154     0.0147
## 5 06    39148760   0.389      0.601    0.0579    0.143 
## 6 08     5531141   0.214      0.842    0.0412    0.0312</code></pre>
</div>
<div id="county-level" class="section level3">
<h3><span class="header-section-number">5.4.2</span> County Level</h3>
<p>Similarly, for county level</p>
<ul>
<li>use <code>geometry = county</code> to download for all counties in the U.S.</li>
<li>use <code>geometry = county, state = sampleStateName</code> for all counties within a state</li>
<li>use <code>geometry = county, state = sampleStateName, county = sampleCountyName</code> for a specific county</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">countyDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;county&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>, </a>
<a class="sourceLine" id="cb90-2" data-line-number="2">                                                        <span class="dt">hispanic =</span><span class="st">&quot;B03003_003&quot;</span>, </a>
<a class="sourceLine" id="cb90-3" data-line-number="3">                                                        <span class="dt">notHispanic =</span> <span class="st">&quot;B03003_002&quot;</span>,</a>
<a class="sourceLine" id="cb90-4" data-line-number="4">                                                        <span class="dt">white =</span> <span class="st">&quot;B02001_002&quot;</span>, </a>
<a class="sourceLine" id="cb90-5" data-line-number="5">                                                        <span class="dt">afrAm =</span> <span class="st">&quot;B02001_003&quot;</span>, </a>
<a class="sourceLine" id="cb90-6" data-line-number="6">                                                        <span class="dt">asian =</span> <span class="st">&quot;B02001_005&quot;</span>), </a>
<a class="sourceLine" id="cb90-7" data-line-number="7">                    <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">state =</span> <span class="st">&#39;IL&#39;</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb90-8" data-line-number="8"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb90-9" data-line-number="9"><span class="st">            </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb90-10" data-line-number="10"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hispPr18  =</span> hispanic<span class="op">/</span>totPop18, <span class="dt">WhitePr18 =</span> white<span class="op">/</span>totPop18,</a>
<a class="sourceLine" id="cb90-11" data-line-number="11">                   <span class="dt">AfrAmPr18 =</span> afrAm<span class="op">/</span>totPop18, <span class="dt">AsianPr18 =</span> asian<span class="op">/</span>totPop18) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-12" data-line-number="12"><span class="st">            </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb90-13" data-line-number="13"></a>
<a class="sourceLine" id="cb90-14" data-line-number="14"><span class="kw">head</span>(countyDf)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   GEOID totPop18 hispPr18 WhitePr18 AfrAmPr18 AsianPr18
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 17001    66427   0.0154     0.931   0.0408   0.00813 
## 2 17003     6532   0.0112     0.624   0.332    0.000919
## 3 17005    16712   0.0346     0.909   0.0624   0.0117  
## 4 17007    53606   0.214      0.874   0.0222   0.0118  
## 5 17009     6675   0.0428     0.774   0.204    0.00554 
## 6 17011    33381   0.0897     0.936   0.00932  0.00866</code></pre>
<p>And now we can save the dataset in CSV file using code below.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">write.csv</span>(countyDf, <span class="st">&quot;data/ILcounty_ACS.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="census-tract-level" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Census Tract Level</h3>
<p>For census tract level, at the minimum <em>stateName</em> needs to be provided.</p>
<ul>
<li>use <code>geometry = tract, state = sampleStateName</code> to download all tracts within a state</li>
<li>use <code>geometry = tract, state = sampleStateName, county = sampleCountyName</code> to download all tracts within a specific county</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">tractDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;tract&#39;</span>,<span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>, </a>
<a class="sourceLine" id="cb93-2" data-line-number="2">                                                   <span class="dt">hispanic =</span><span class="st">&quot;B03003_003&quot;</span>, </a>
<a class="sourceLine" id="cb93-3" data-line-number="3">                                                   <span class="dt">notHispanic =</span> <span class="st">&quot;B03003_002&quot;</span>,</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">                                                   <span class="dt">white =</span> <span class="st">&quot;B02001_002&quot;</span>, </a>
<a class="sourceLine" id="cb93-5" data-line-number="5">                                                   <span class="dt">afrAm =</span> <span class="st">&quot;B02001_003&quot;</span>, </a>
<a class="sourceLine" id="cb93-6" data-line-number="6">                                                   <span class="dt">asian =</span> <span class="st">&quot;B02001_005&quot;</span>), </a>
<a class="sourceLine" id="cb93-7" data-line-number="7">                    <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">state =</span> <span class="st">&#39;IL&#39;</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-8" data-line-number="8"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-9" data-line-number="9"><span class="st">            </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-10" data-line-number="10"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hispPr18  =</span> hispanic<span class="op">/</span>totPop18, <span class="dt">WhitePr18 =</span> white<span class="op">/</span>totPop18, </a>
<a class="sourceLine" id="cb93-11" data-line-number="11">                   <span class="dt">AfrAmPr18 =</span> afrAm<span class="op">/</span>totPop18, <span class="dt">AsianPr18 =</span> asian<span class="op">/</span>totPop18) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-12" data-line-number="12"><span class="st">            </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb93-13" data-line-number="13"></a>
<a class="sourceLine" id="cb93-14" data-line-number="14"><span class="kw">head</span>(tractDf)</a></code></pre></div>
</div>
<div id="zipcode-level" class="section level3">
<h3><span class="header-section-number">5.4.4</span> Zipcode Level</h3>
<p>For zipcode level, use <code>geometry = zcta</code>. Given zips cross county/state lines, zcta data is only available for the entire U.S.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">zctaDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;zcta&#39;</span>,<span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>, </a>
<a class="sourceLine" id="cb94-2" data-line-number="2">                                                   <span class="dt">hispanic =</span><span class="st">&quot;B03003_003&quot;</span>, </a>
<a class="sourceLine" id="cb94-3" data-line-number="3">                                                   <span class="dt">notHispanic =</span> <span class="st">&quot;B03003_002&quot;</span>,</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">                                                   <span class="dt">white =</span> <span class="st">&quot;B02001_002&quot;</span>, </a>
<a class="sourceLine" id="cb94-5" data-line-number="5">                                                   <span class="dt">afrAm =</span> <span class="st">&quot;B02001_003&quot;</span>, </a>
<a class="sourceLine" id="cb94-6" data-line-number="6">                                                   <span class="dt">asian =</span> <span class="st">&quot;B02001_005&quot;</span>), </a>
<a class="sourceLine" id="cb94-7" data-line-number="7">                    <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-8" data-line-number="8"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-9" data-line-number="9"><span class="st">            </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb94-10" data-line-number="10"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hispPr18  =</span> hispanic<span class="op">/</span>totPop18, <span class="dt">WhitePr18 =</span> white<span class="op">/</span>totPop18, </a>
<a class="sourceLine" id="cb94-11" data-line-number="11">                   <span class="dt">AfrAmPr18 =</span> afrAm<span class="op">/</span>totPop18, <span class="dt">AsianPr18 =</span> asian<span class="op">/</span>totPop18) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb94-12" data-line-number="12"><span class="st">            </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a></code></pre></div>
<p>Inspect the data.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">head</span>(zctaDf)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   GEOID totPop18 hispPr18 WhitePr18 AfrAmPr18 AsianPr18
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 00601    17242    0.997     0.755   0.00841  0.000174
## 2 00602    38442    0.935     0.794   0.0278   0       
## 3 00603    48814    0.974     0.765   0.0395   0.00746 
## 4 00606     6437    0.998     0.408   0.0231   0       
## 5 00610    27073    0.962     0.755   0.0257   0       
## 6 00612    60303    0.993     0.807   0.0456   0.00985</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw">dim</span>(zctaDf)</a></code></pre></div>
<pre><code>## [1] 33120     6</code></pre>
<p>Given zipcode data can only be sourced for the entire nation, after sourcing it, we can filter them for certain region,e.g. below we can filter for zipcodes in Chicago by using <code>str_detect</code> and then save it to a .csv file.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">zipChicagoDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;zcta&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">perCapInc =</span> <span class="st">&quot;DP03_0088&quot;</span>),<span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">                  </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">                  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>( GEOID,<span class="st">&quot;^606&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="st">                  </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-5" data-line-number="5"><span class="st">                  </span><span class="kw">select</span>(GEOID, perCapInc)</a></code></pre></div>
<pre><code>## Getting data from the 2014-2018 5-year ACS</code></pre>
<pre><code>## Using the ACS Data Profile</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">write.csv</span>(zipChicagoDf , <span class="dt">file =</span> <span class="st">&quot;data/chizips_ACS.csv&quot;</span>)</a></code></pre></div>
<p>For more details on the other geographies available via the <em>tidycensus package</em>, check <a href="https://walker-data.com/tidycensus/articles/basic-usage.html#geography-in-tidycensus-1">here</a>.</p>
</div>
</div>
<div id="CD-get-geometry" class="section level2">
<h2><span class="header-section-number">5.5</span> Get Geometry</h2>
<p>Geometry/Geographic Boundaries are one of the key features for American Community Survey Data as they set up the framework for data collection and estimation. While boundaries don’t change often, updates do occur from time to time and census data for a specific year generally tends to use the boundaries available at the beginning of that year. Most ACS products since 2010 reflect the 2010 Census Geographic Definitions. Given certain boundaries like congressional districts, census tracts &amp; block groups are updated after every decennial census, products for year 2009 and earlier will have significantly different boundaries from that in 2010. We recommend using IPUMS datasets to generate estimates for years prior to 2010.</p>
<p>The datasets downloaded so far did not have a spatial geometry feature attached to them. To run any spatial analysis on the race data above, we would need to join these dataframes to another spatially-enabled <code>sf</code> object. We can do so by joining on the ‘GEOID’ or any other identifier. We can download the geometry information using two methods :</p>
<ol style="list-style-type: decimal">
<li>using <code>tigris</code></li>
<li>using <code>tidycensus</code></li>
</ol>
<div id="using-tigris" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Using tigris</h3>
<p>To download and use the Tiger Shapefiles shared by the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">US Census Bureau</a> we will use the <code>tigris</code> package. Set <code>cb = TRUE</code> to get generalized files, these don’t have high resolution details and hence are smaller in size.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">yeartoFetch &lt;-<span class="st"> </span><span class="dv">2018</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"></a>
<a class="sourceLine" id="cb103-3" data-line-number="3">stateShp &lt;-<span class="st"> </span><span class="kw">states</span>(<span class="dt">year =</span> yeartoFetch, <span class="dt">cb =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">countyShp &lt;-<span class="st"> </span><span class="kw">counties</span>(<span class="dt">year =</span> yeartoFetch, <span class="dt">state =</span> <span class="st">&#39;IL&#39;</span>, <span class="dt">cb =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">tractShp &lt;-<span class="st"> </span><span class="kw">tracts</span>(<span class="dt">state =</span> <span class="st">&#39;IL&#39;</span>,<span class="dt">year =</span> yeartoFetch, <span class="dt">cb =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb103-6" data-line-number="6">zctaShp &lt;-<span class="st"> </span><span class="kw">zctas</span>(<span class="dt">year =</span> yeartoFetch, <span class="dt">cb =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p>Now we can merge these geometry files with the race data downloaded in previous section.</p>
<p>For states:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="co"># check object types &amp; identifier variable type</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="co"># str(stateShp)</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="co"># str(stateDf) </span></a>
<a class="sourceLine" id="cb104-4" data-line-number="4">stateShp &lt;-<span class="st"> </span><span class="kw">merge</span>(stateShp, stateDf, <span class="dt">by.x  =</span> <span class="st">&#39;STATEFP&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb104-5" data-line-number="5"><span class="kw">head</span>(stateShp)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 14 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -179.1489 ymin: 30.22333 xmax: 179.7785 ymax: 71.36516
## CRS:            4269
##   STATEFP  STATENS    AFFGEOID GEOID STUSPS       NAME LSAD        ALAND       AWATER totPop18
## 1      01 01779775 0400000US01    01     AL    Alabama   00 1.311740e+11   4593327154  4864680
## 2      02 01785533 0400000US02    02     AK     Alaska   00 1.478840e+12 245481577452   738516
## 3      04 01779777 0400000US04    04     AZ    Arizona   00 2.941986e+11   1027337603  6946685
## 4      05 00068085 0400000US05    05     AR   Arkansas   00 1.347689e+11   2962859592  2990671
## 5      06 01779778 0400000US06    06     CA California   00 4.035039e+11  20463871877 39148760
## 6      08 01779779 0400000US08    08     CO   Colorado   00 2.684229e+11   1181621593  5531141
##     hispPr18 WhitePr18  AfrAmPr18  AsianPr18                       geometry
## 1 0.04175938 0.6819468 0.26583167 0.01328124 MULTIPOLYGON (((-88.05338 3...
## 2 0.06930926 0.6483732 0.03267228 0.06303993 MULTIPOLYGON (((179.4825 51...
## 3 0.31141645 0.7721872 0.04394312 0.03294910 MULTIPOLYGON (((-114.8163 3...
## 4 0.07324510 0.7700192 0.15413598 0.01470840 MULTIPOLYGON (((-94.61783 3...
## 5 0.38881377 0.6010169 0.05792968 0.14315496 MULTIPOLYGON (((-118.6044 3...
## 6 0.21420427 0.8417041 0.04120994 0.03122231 MULTIPOLYGON (((-109.0603 3...</code></pre>
<p>Similarly for counties, zctas &amp; census tracts we can use the code below and save the shapefiles.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">countyShp &lt;-<span class="st"> </span><span class="kw">merge</span>(countyShp, countyDf, <span class="dt">by.x  =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="st">                </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb106-3" data-line-number="3"></a>
<a class="sourceLine" id="cb106-4" data-line-number="4">tractShp &lt;-<span class="st"> </span><span class="kw">merge</span>(tractShp, tractDf, <span class="dt">by.x  =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-5" data-line-number="5"><span class="st">              </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb106-6" data-line-number="6"></a>
<a class="sourceLine" id="cb106-7" data-line-number="7">zctaShp &lt;-<span class="st"> </span><span class="kw">merge</span>(zctaShp, zctaDf, <span class="dt">by.x  =</span> <span class="st">&#39;GEOID10&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-8" data-line-number="8"><span class="st">              </span><span class="kw">select</span>(GEOID10,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb106-9" data-line-number="9"></a>
<a class="sourceLine" id="cb106-10" data-line-number="10"><span class="kw">write_sf</span>(countyShp, <span class="st">&quot;data/Chicago_Zip_PCI_18.shp&quot;</span>)</a></code></pre></div>
<p>Now we can finally filter the zipcodes for Chicago. and save the census tract results with geometry in a shapefile using <code>write_sf</code>.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">zipChicagoShp &lt;-<span class="st"> </span><span class="kw">merge</span>(zctaShp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(GEOID10,<span class="st">&quot;^606&quot;</span>)), </a>
<a class="sourceLine" id="cb107-2" data-line-number="2">                       zipChicagoDf, <span class="dt">by.x  =</span> <span class="st">&#39;GEOID10&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="st">                  </span><span class="kw">select</span>(GEOID10,totPop18,perCapInc)</a></code></pre></div>
</div>
<div id="using-tidycensus" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Using tidycensus</h3>
<p>The previous method adds an additional step of using <code>tigris</code> package to download the shapefile.
The tidycensus package already has the wrapper for invoking tigris within the <code>get_acs()</code> function, and we can simply download the dataset with geometry feature by using <code>geometry = TRUE</code>.</p>
<p>The wrapper adds the geometry information to each variable sourced, and the file size can become large in the intermediary steps and slow down the performance, even though the data is in tidy format. So if you are looking to download many variables with large API requests, we recommend downloading the dataset without geometry information and then downloading a nominal variable like total population or per capita income with get geometry using <code>get_acs()</code> or simply using the <code>tigris</code> method, as covered in previous section &amp; then implementing a merge. We have illustrated both methods below.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">tractDf &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;tract&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>, </a>
<a class="sourceLine" id="cb108-2" data-line-number="2">                                                      <span class="dt">hispanic =</span><span class="st">&quot;B03003_003&quot;</span>, </a>
<a class="sourceLine" id="cb108-3" data-line-number="3">                                                      <span class="dt">notHispanic =</span> <span class="st">&quot;B03003_002&quot;</span>,</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">                                                      <span class="dt">white =</span> <span class="st">&quot;B02001_002&quot;</span>, </a>
<a class="sourceLine" id="cb108-5" data-line-number="5">                                                      <span class="dt">afrAm =</span> <span class="st">&quot;B02001_003&quot;</span>, </a>
<a class="sourceLine" id="cb108-6" data-line-number="6">                                                      <span class="dt">asian =</span> <span class="st">&quot;B02001_005&quot;</span>), </a>
<a class="sourceLine" id="cb108-7" data-line-number="7">                   <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">state  =</span> <span class="st">&#39;IL&#39;</span>, <span class="dt">geometry =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb108-8" data-line-number="8"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-9" data-line-number="9"><span class="st">            </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-10" data-line-number="10"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">hispPr18  =</span> hispanic<span class="op">/</span>totPop18, <span class="dt">WhitePr18 =</span> white<span class="op">/</span>totPop18,</a>
<a class="sourceLine" id="cb108-11" data-line-number="11">                   <span class="dt">AfrAmPr18 =</span> afrAm<span class="op">/</span>totPop18, <span class="dt">AsianPr18 =</span> asian<span class="op">/</span>totPop18) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb108-12" data-line-number="12"><span class="st">            </span><span class="kw">select</span>(GEOID,totPop18,hispPr18,WhitePr18,AfrAmPr18, AsianPr18)</a>
<a class="sourceLine" id="cb108-13" data-line-number="13"></a>
<a class="sourceLine" id="cb108-14" data-line-number="14">tractShp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;tract&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">perCapitaIncome =</span> <span class="st">&quot;DP03_0088&quot;</span>),</a>
<a class="sourceLine" id="cb108-15" data-line-number="15">                    <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">state  =</span> <span class="st">&#39;IL&#39;</span>, <span class="dt">geometry =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-16" data-line-number="16"><span class="st">            </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-17" data-line-number="17"><span class="st">            </span><span class="kw">spread</span>(variable, estimate)</a>
<a class="sourceLine" id="cb108-18" data-line-number="18">                </a>
<a class="sourceLine" id="cb108-19" data-line-number="19"></a>
<a class="sourceLine" id="cb108-20" data-line-number="20">tractsShp &lt;-<span class="st"> </span><span class="kw">merge</span>(tractShp, tractDf, <span class="dt">by.x =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">by.y =</span> <span class="st">&#39;GEOID&#39;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb108-21" data-line-number="21"><span class="kw">head</span>(tractShp)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -88.79336 ymin: 41.7943 xmax: -87.63536 ymax: 41.95088
## CRS:            4269
##         GEOID                                        NAME perCapitaIncome
## 1 17031843800    Census Tract 8438, Cook County, Illinois           19331
## 2 17037001002 Census Tract 10.02, DeKalb County, Illinois           11308
## 3 17031243000    Census Tract 2430, Cook County, Illinois           48843
## 4 17031250600    Census Tract 2506, Cook County, Illinois           22905
## 5 17031251700    Census Tract 2517, Cook County, Illinois           14739
## 6 17031260400    Census Tract 2604, Cook County, Illinois           12610
##                         geometry
## 1 MULTIPOLYGON (((-87.64554 4...
## 2 MULTIPOLYGON (((-88.79317 4...
## 3 MULTIPOLYGON (((-87.68195 4...
## 4 MULTIPOLYGON (((-87.7756 41...
## 5 MULTIPOLYGON (((-87.74826 4...
## 6 MULTIPOLYGON (((-87.74061 4...</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">zipChicagoShp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&#39;zcta&#39;</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">totPop18 =</span> <span class="st">&quot;B01001_001&quot;</span>,</a>
<a class="sourceLine" id="cb110-2" data-line-number="2">                                                           <span class="dt">perCapInc =</span> <span class="st">&quot;DP03_0088&quot;</span>), </a>
<a class="sourceLine" id="cb110-3" data-line-number="3">                         <span class="dt">year =</span> <span class="dv">2018</span>, <span class="dt">geometry =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="st">                  </span><span class="kw">select</span>(GEOID, NAME, variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="st">                  </span><span class="kw">spread</span>(variable, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="st">                  </span><span class="kw">rename</span>(<span class="dt">totPop18 =</span> B01001_<span class="dv">001</span>, <span class="dt">perCapitaInc =</span> DP03_<span class="dv">0088</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-7" data-line-number="7"><span class="st">                  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(GEOID,<span class="st">&quot;^606&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-8" data-line-number="8"><span class="st">                  </span><span class="kw">select</span>(GEOID,totPop18,perCapitaInc)</a>
<a class="sourceLine" id="cb110-9" data-line-number="9"><span class="kw">head</span>(zipChicagoShp)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -87.64138 ymin: 41.85206 xmax: -87.60586 ymax: 41.88908
## CRS:            4269
## # A tibble: 6 x 4
##   GEOID totPop18 perCapitaInc                                                                 geometry
##   &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;                                                       &lt;MULTIPOLYGON [°]&gt;
## 1 60601    14675        92125 (((-87.63396 41.88698, -87.63102 41.88751, -87.628 41.88751, -87.62524 …
## 2 60602     1244       100507 (((-87.63389 41.88447, -87.62536 41.8845, -87.6243 41.88212, -87.62765 …
## 3 60603     1174       117992 (((-87.63382 41.88195, -87.62781 41.88204, -87.62765 41.88077, -87.6243…
## 4 60604      782       114575 (((-87.63375 41.87939, -87.62428 41.87955, -87.62298 41.8783, -87.62299…
## 5 60605    27519        83408 (((-87.63311 41.87686, -87.62421 41.877, -87.62299 41.8759, -87.62298 4…
## 6 60606     3101       132765 (((-87.63998 41.88851, -87.63936 41.88908, -87.63871 41.88724, -87.6376…</code></pre>
</div>
</div>
<div id="save-data-2" class="section level2">
<h2><span class="header-section-number">5.6</span> Save Data</h2>
<p>We previously saved our files as CSVs. Now let’s save the final shapefile of ZCTA scale data for future use, using <code>write_sf</code>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">write_sf</span>(zipChicagoShp, <span class="st">&quot;data/chizips_ACS.shp&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in abbreviate_shapefile_names(obj): Field names abbreviated for ESRI Shapefile driver</code></pre>
</div>
<div id="CD-appendix" class="section level2">
<h2><span class="header-section-number">5.7</span> Appendix</h2>
<div id="CD-explore-variables" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Explore variables</h3>
<p>Using <code>tidycensus</code> we can download datasets from various types of tables. The ones most commonly used are:</p>
<ol style="list-style-type: decimal">
<li><em>Data Profiles</em> - These are the most commonly used collection of variables grouped by category, e.g. Social (DP02), Economic (DP03), Housing (DP04), Demographic (DP05)</li>
<li><em>Subject Profiles</em> - These generally have more detailed information variables (than DP) grouped by category, e.g. Age &amp; Sex (S0101), Disability Characteristics (S1810)</li>
<li>The package also allows access to a suite of B &amp; C tables.</li>
</ol>
<p>We can explore all the variables for our year of interest by running the code below. Please note as the Profiles evolve, variable IDs might change from year to year.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">sVarnames &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2018</span>, <span class="st">&quot;acs5/subject&quot;</span>, <span class="dt">cache =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">pVarnames &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2018</span>, <span class="st">&quot;acs5/profile&quot;</span>, <span class="dt">cache =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">otherVarnames &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2018</span>, <span class="st">&quot;acs5&quot;</span>, <span class="dt">cache =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb114-4" data-line-number="4"></a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="kw">head</span>(pVarnames)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   name     label                                                      concept                         
##   &lt;chr&gt;    &lt;chr&gt;                                                      &lt;chr&gt;                           
## 1 DP02_00… Estimate!!HOUSEHOLDS BY TYPE!!Total households             SELECTED SOCIAL CHARACTERISTICS…
## 2 DP02_00… Percent Estimate!!HOUSEHOLDS BY TYPE!!Total households     SELECTED SOCIAL CHARACTERISTICS…
## 3 DP02_00… Estimate!!HOUSEHOLDS BY TYPE!!Total households!!Family ho… SELECTED SOCIAL CHARACTERISTICS…
## 4 DP02_00… Percent Estimate!!HOUSEHOLDS BY TYPE!!Total households!!F… SELECTED SOCIAL CHARACTERISTICS…
## 5 DP02_00… Estimate!!HOUSEHOLDS BY TYPE!!Total households!!Family ho… SELECTED SOCIAL CHARACTERISTICS…
## 6 DP02_00… Percent Estimate!!HOUSEHOLDS BY TYPE!!Total households!!F… SELECTED SOCIAL CHARACTERISTICS…</code></pre>
<p>A tibble with table &amp; variable information has three columns : <em>name, label, concept</em>.</p>
<p>Name is a combination of table id and variable id within that table. Concept generally identifies the table name or grouping used to arrange variables. Label provides textual details about the variable.</p>
<p>We can explore these tibbles to identify the correct variable ID <code>name</code> to use with the <code>get_acs()</code> function by using <code>View(sVarnames)</code> or other filters e.g. for age</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">sVarnames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(concept, <span class="st">&quot;AGE AND SEX&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for this concept</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">              </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(label, <span class="st">&quot;Under 5 years&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for variables</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">sub</span>(<span class="st">&#39;^Estimate!!&#39;</span>, <span class="st">&#39;&#39;</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove unnecessary text</span></a>
<a class="sourceLine" id="cb116-4" data-line-number="4"><span class="st">              </span><span class="kw">select</span>(<span class="dt">variableId =</span> name, label) <span class="co"># drop unnecessary columns and rename</span></a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   variableId    label                                               
##   &lt;chr&gt;         &lt;chr&gt;                                               
## 1 S0101_C01_002 Total!!Total population!!AGE!!Under 5 years         
## 2 S0101_C02_002 Percent!!Total population!!AGE!!Under 5 years       
## 3 S0101_C03_002 Male!!Total population!!AGE!!Under 5 years          
## 4 S0101_C04_002 Percent Male!!Total population!!AGE!!Under 5 years  
## 5 S0101_C05_002 Female!!Total population!!AGE!!Under 5 years        
## 6 S0101_C06_002 Percent Female!!Total population!!AGE!!Under 5 years</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">sVarnames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">5</span>) <span class="op">==</span><span class="st"> &quot;S0101&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for these tables</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="st">              </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(label, <span class="st">&quot;Under 5 years&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for variables</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">sub</span>(<span class="st">&#39;^Estimate!!&#39;</span>, <span class="st">&#39;&#39;</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove unnecessary text</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4"><span class="st">              </span><span class="kw">select</span>(<span class="dt">variableId =</span> name, label) <span class="co"># drop unnecessary columns and rename</span></a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   variableId    label                                               
##   &lt;chr&gt;         &lt;chr&gt;                                               
## 1 S0101_C01_002 Total!!Total population!!AGE!!Under 5 years         
## 2 S0101_C02_002 Percent!!Total population!!AGE!!Under 5 years       
## 3 S0101_C03_002 Male!!Total population!!AGE!!Under 5 years          
## 4 S0101_C04_002 Percent Male!!Total population!!AGE!!Under 5 years  
## 5 S0101_C05_002 Female!!Total population!!AGE!!Under 5 years        
## 6 S0101_C06_002 Percent Female!!Total population!!AGE!!Under 5 years</code></pre>
<p>e.g per capita income, we can check on DP table variables.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">pVarnames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(label, <span class="st">&quot;Per capita&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for variables</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">sub</span>(<span class="st">&#39;^Estimate!!&#39;</span>, <span class="st">&#39;&#39;</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove unnecessary text</span></a>
<a class="sourceLine" id="cb120-3" data-line-number="3"><span class="st">              </span><span class="kw">select</span>(<span class="dt">variable =</span> name, label) <span class="co"># drop unnecessary columns and rename</span></a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   variable   label                                                                                    
##   &lt;chr&gt;      &lt;chr&gt;                                                                                    
## 1 DP03_0088  INCOME AND BENEFITS (IN 2018 INFLATION-ADJUSTED DOLLARS)!!Per capita income (dollars)    
## 2 DP03_0088P Percent Estimate!!INCOME AND BENEFITS (IN 2018 INFLATION-ADJUSTED DOLLARS)!!Per capita i…</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">pVarnames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(label, <span class="st">&quot;Under 5 years&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for variables</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">sub</span>(<span class="st">&#39;^Estimate!!&#39;</span>, <span class="st">&#39;&#39;</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove unnecessary text</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3"><span class="st">              </span><span class="kw">select</span>(<span class="dt">variable =</span> name, label) <span class="co"># drop unnecessary columns and rename</span></a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   variable   label                                                         
##   &lt;chr&gt;      &lt;chr&gt;                                                         
## 1 DP05_0005  SEX AND AGE!!Total population!!Under 5 years                  
## 2 DP05_0005P Percent Estimate!!SEX AND AGE!!Total population!!Under 5 years</code></pre>
<p>The order and structure of profile tables can change from year to year, hence the variable Id or label, so when downloading same dataset over different years we recommend using the standard B &amp; C tables.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">otherVarnames <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(label, <span class="st">&quot;Per capita&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># search for variables</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">sub</span>(<span class="st">&#39;^Estimate!!&#39;</span>, <span class="st">&#39;&#39;</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove unnecessary text</span></a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="st">              </span><span class="kw">select</span>(<span class="dt">variable =</span> name, label) <span class="co"># drop unnecessary columns and rename</span></a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    variable    label                                                                       
##    &lt;chr&gt;       &lt;chr&gt;                                                                       
##  1 B19301_001  Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  2 B19301A_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  3 B19301B_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  4 B19301C_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  5 B19301D_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  6 B19301E_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  7 B19301F_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  8 B19301G_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
##  9 B19301H_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)
## 10 B19301I_001 Per capita income in the past 12 months (in 2018 inflation-adjusted dollars)</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="link-contextual-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizeArealData-tutorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
