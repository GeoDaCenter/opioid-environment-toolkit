<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Thematic Mapping | Opioid Environment Toolkit</title>
  <meta name="description" content="4 Thematic Mapping | Opioid Environment Toolkit" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Thematic Mapping | Opioid Environment Toolkit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Thematic Mapping | Opioid Environment Toolkit" />
  
  
  

<meta name="author" content="Created by : Center for Spatial Data Science" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="link-contextual-data.html"/>
<link rel="next" href="centroid-access-tutorial.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-basics"><i class="fa fa-check"></i>Software Basics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#author-team"><i class="fa fa-check"></i>Author Team</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html"><i class="fa fa-check"></i><b>1</b> Spatial Data Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-spatial-data"><i class="fa fa-check"></i><b>1.1</b> Defining spatial data</a></li>
<li class="chapter" data-level="1.2" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-vector-data"><i class="fa fa-check"></i><b>1.2</b> Spatial data formats</a></li>
<li class="chapter" data-level="1.3" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#spatial-data-types"><i class="fa fa-check"></i><b>1.3</b> Spatial data types</a></li>
<li class="chapter" data-level="1.4" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-crs"><i class="fa fa-check"></i><b>1.4</b> Coordiante Reference System</a></li>
<li class="chapter" data-level="" data-path="spatial-data-introduction.html"><a href="spatial-data-introduction.html#SD-appendix"><i class="fa fa-check"></i>Further resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="buffer_analysis.html"><a href="buffer_analysis.html"><i class="fa fa-check"></i><b>2</b> Buffer Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#environment-setup"><i class="fa fa-check"></i><b>2.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="2.2.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-i-o"><i class="fa fa-check"></i><b>2.2.1</b> Input/Output</a></li>
<li class="chapter" data-level="2.2.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-lib"><i class="fa fa-check"></i><b>2.2.2</b> Load Libraries</a></li>
<li class="chapter" data-level="2.2.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#BA-data"><i class="fa fa-check"></i><b>2.2.3</b> Load Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#simple-overlay-map"><i class="fa fa-check"></i><b>2.3</b> Simple Overlay Map</a></li>
<li class="chapter" data-level="2.4" data-path="buffer_analysis.html"><a href="buffer_analysis.html#spatial-transformation"><i class="fa fa-check"></i><b>2.4</b> Spatial Transformation</a><ul>
<li class="chapter" data-level="2.4.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#transform-crs"><i class="fa fa-check"></i><b>2.4.1</b> Transform CRS</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="buffer_analysis.html"><a href="buffer_analysis.html#generate-buffers"><i class="fa fa-check"></i><b>2.5</b> Generate Buffers</a><ul>
<li class="chapter" data-level="2.5.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#visualize-buffers"><i class="fa fa-check"></i><b>2.5.1</b> Visualize buffers</a></li>
<li class="chapter" data-level="2.5.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#buffer-union"><i class="fa fa-check"></i><b>2.5.2</b> Buffer union</a></li>
<li class="chapter" data-level="2.5.3" data-path="buffer_analysis.html"><a href="buffer_analysis.html#save-data"><i class="fa fa-check"></i><b>2.5.3</b> Save Data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="buffer_analysis.html"><a href="buffer_analysis.html#rinse-repeat"><i class="fa fa-check"></i><b>2.6</b> Rinse &amp; Repeat</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="link-contextual-data.html"><a href="link-contextual-data.html"><i class="fa fa-check"></i><b>3</b> Link Community Data</a><ul>
<li class="chapter" data-level="3.1" data-path="buffer_analysis.html"><a href="buffer_analysis.html#overview"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="buffer_analysis.html"><a href="buffer_analysis.html#environment-setup"><i class="fa fa-check"></i><b>3.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="3.2.1" data-path="link-contextual-data.html"><a href="link-contextual-data.html#packages-used"><i class="fa fa-check"></i><b>3.2.1</b> Packages used</a></li>
<li class="chapter" data-level="3.2.2" data-path="link-contextual-data.html"><a href="link-contextual-data.html#required-inputs-and-expected-outputs"><i class="fa fa-check"></i><b>3.2.2</b> Required Inputs and Expected Outputs</a></li>
<li class="chapter" data-level="3.2.3" data-path="link-contextual-data.html"><a href="link-contextual-data.html#load-the-packages"><i class="fa fa-check"></i><b>3.2.3</b> Load the packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="link-contextual-data.html"><a href="link-contextual-data.html#load-data"><i class="fa fa-check"></i><b>3.3</b> Load data</a></li>
<li class="chapter" data-level="3.4" data-path="link-contextual-data.html"><a href="link-contextual-data.html#clean-merge-data"><i class="fa fa-check"></i><b>3.4</b> Clean &amp; Merge Data</a></li>
<li class="chapter" data-level="3.5" data-path="link-contextual-data.html"><a href="link-contextual-data.html#visualize-data"><i class="fa fa-check"></i><b>3.5</b> Visualize Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html"><i class="fa fa-check"></i><b>4</b> Thematic Mapping</a><ul>
<li class="chapter" data-level="4.1" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-research-question"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-setup"><i class="fa fa-check"></i><b>4.2</b> Environment Setup</a></li>
<li class="chapter" data-level="4.3" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-load-variables"><i class="fa fa-check"></i><b>4.3</b> Load data</a></li>
<li class="chapter" data-level="4.4" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-mapping"><i class="fa fa-check"></i><b>4.4</b> Thematic Plotting</a><ul>
<li class="chapter" data-level="4.4.1" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-quantile-plot"><i class="fa fa-check"></i><b>4.4.1</b> Quantile</a></li>
<li class="chapter" data-level="4.4.2" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-jenks-plot"><i class="fa fa-check"></i><b>4.4.2</b> Natural Breaks</a></li>
<li class="chapter" data-level="4.4.3" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-stdev-plot"><i class="fa fa-check"></i><b>4.4.3</b> Standard Deviation</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-appendix"><i class="fa fa-check"></i><b>4.5</b> Appendix</a><ul>
<li class="chapter" data-level="" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-set-palette"><i class="fa fa-check"></i>Set Color Palette</a></li>
<li class="chapter" data-level="" data-path="visualizeArealData-tutorial.html"><a href="visualizeArealData-tutorial.html#TM-colorbrewer"><i class="fa fa-check"></i>Use ColorBrewer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html"><i class="fa fa-check"></i><b>5</b> Min. Dist Access Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-research-question"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-setup"><i class="fa fa-check"></i><b>5.2</b> Environment Setup</a><ul>
<li class="chapter" data-level="5.2.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-packages1"><i class="fa fa-check"></i><b>5.2.1</b> Packages used</a></li>
<li class="chapter" data-level="5.2.2" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-i-o"><i class="fa fa-check"></i><b>5.2.2</b> Required Inputs and Expected Outputs</a></li>
<li class="chapter" data-level="5.2.3" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-packages2"><i class="fa fa-check"></i><b>5.2.3</b> Load the packages</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-read-resources"><i class="fa fa-check"></i><b>5.3</b> Load data</a></li>
<li class="chapter" data-level="5.4" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-calculate-centroids"><i class="fa fa-check"></i><b>5.4</b> Calculate centroids</a><ul>
<li class="chapter" data-level="5.4.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#visualize-confirm"><i class="fa fa-check"></i><b>5.4.1</b> Visualize &amp; Confirm</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-correct-projection"><i class="fa fa-check"></i><b>5.5</b> Standardize CRS</a></li>
<li class="chapter" data-level="" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-distance"><i class="fa fa-check"></i>Calculate min distance</a><ul>
<li class="chapter" data-level="5.5.1" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#merge-data-back-to-area-data"><i class="fa fa-check"></i><b>5.5.1</b> Merge data back to Area Data</a></li>
<li class="chapter" data-level="5.5.2" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#visualize-confirm-1"><i class="fa fa-check"></i><b>5.5.2</b> Visualize &amp; Confirm</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="centroid-access-tutorial.html"><a href="centroid-access-tutorial.html#CA-save"><i class="fa fa-check"></i><b>5.6</b> Save Data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Opioid Environment Toolkit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="thematic-maps" class="section level1">
<h1><span class="header-section-number">4</span> Thematic Mapping</h1>
<div id="TM-research-question" class="section level2">
<h2><span class="header-section-number">4.1</span> Overview</h2>
<p>Once we have downloaded the contextual data and generated the access metrics, we can start visualizing them to identify any spatial patterns. This can help identify whether a variable is homogeneously distributed across space or do we see clustering &amp; spatial heterogeneity. In this tutorial we will cover methods to plot data variables spatially i.e. create thematic maps, technically known as choropleth maps. We will cover the most commonly used types of choropleth mapping techniques employed in R. Please note the methods covered here are mere an introduction to spatial plotting. Thus, in this tutorial our objectives are to:</p>
<ul>
<li>item 1</li>
<li>item 2</li>
<li>item 3</li>
</ul>
</div>
<div id="TM-setup" class="section level2">
<h2><span class="header-section-number">4.2</span> Environment Setup</h2>
<p>To replicate the codes &amp; functions illustrated in this tutorial, you’ll need to have R and RStudio downloaded and installed on your system. This tutorial assumes some familiarity with the R programming language.</p>
<div id="TM-packages1" class="section level4">
<h4><span class="header-section-number">4.2.0.1</span> Packages used</h4>
<p>We will use the following packages in this tutorial:</p>
<ul>
<li><code>tidyverse</code>: to manipulate data</li>
<li><code>tmap</code>: to visualize and create maps</li>
<li><code>sf</code>: to read/write and manipulate spatial data</li>
</ul>
</div>
<div id="TM-i-o" class="section level4">
<h4><span class="header-section-number">4.2.0.2</span> Required Inputs and Expected Outputs</h4>
<p>We will using the race data for Illinois downloaded &amp; saved as a shapefile using the <a href="link">get-ACS_Data tutorial</a> from the Census Bureau.</p>
<p>Our output will be three thematic maps highlighting the distribution of percentage hispanic population at a county level across the state of Illinois.</p>
</div>
<div id="TM-packages2" class="section level4">
<h4><span class="header-section-number">4.2.0.3</span> Load libraries</h4>
<p>First, load the libraries required.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="kw">library</span>(tmap)</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="kw">library</span>(sf)</a></code></pre></div>
</div>
</div>
<div id="TM-load-variables" class="section level2">
<h2><span class="header-section-number">4.3</span> Load data</h2>
<p>We will read in the shapefile with percentage hispanic population at the county level for the state of Illinois for year 2018.Alternatively, if you have not saved the dataset from <a href="link">get-ACS-Data tutorial</a>, you can access it <a href="https://uchicago.app.box.com/folder/123662619823">here</a>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">ILcounties &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/IL_County_18.shp&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `IL_County_18&#39; from data source `/Users/qinyun/Documents/opioid-environment-toolkit/data/IL_County_18.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 102 features and 8 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -91.51308 ymin: 36.9703 xmax: -87.4952 ymax: 42.50848
## geographic CRS: NAD83</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">head</span>(ILcounties)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 8 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -91.51308 ymin: 36.9703 xmax: -88.70541 ymax: 42.49505
## geographic CRS: NAD83
##   GEOID STATEFP COUNTYFP totPop18   hispPr18 WhitePr18   AfrAmPr18    AsianPr18                       geometry
## 1 17001      17      001    66427 0.01537026 0.9306306 0.040826772 0.0081292246 POLYGON ((-91.51297 40.1810...
## 2 17003      17      003     6532 0.01117575 0.6243111 0.332057563 0.0009185548 POLYGON ((-89.51839 37.2893...
## 3 17005      17      005    16712 0.03458593 0.9088679 0.062410244 0.0117280996 POLYGON ((-89.63926 38.9991...
## 4 17007      17      007    53606 0.21376338 0.8741745 0.022199008 0.0118083797 POLYGON ((-88.94098 42.2388...
## 5 17009      17      009     6675 0.04284644 0.7742322 0.204344569 0.0055430712 POLYGON ((-90.91703 39.9022...
## 6 17011      17      011    33381 0.08972170 0.9361613 0.009316677 0.0086576196 POLYGON ((-89.86235 41.584,...</code></pre>
<p>Lets review the dataset structure. In the R <code>sf</code> data object, the ‘geometry’ column provides the geographic information/boundaries that we can map. This is unique to simple features data structures, and a pretty phenomenal concept.</p>
<p>We can do a quick plot using:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">plot</span>(ILcounties<span class="op">$</span>geometry)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/quick%20plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Before we move ahead, lets convert the percentages for easy plotting using some <code>tidyverse</code> thinking. View the dataframe afterwards to confirm your change was successful.</p>
<p>**Moksha note – please explain what is happening here, how this uses the tidyvrse, etc –</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">ILcounties &lt;-<span class="st"> </span>ILcounties <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">               </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(hispPr18<span class="op">:</span>AsianPr18),</a>
<a class="sourceLine" id="cb55-3" data-line-number="3">                          <span class="dt">.funs =</span> <span class="kw">funs</span>(<span class="kw">round</span>(. <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,<span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="kw">head</span>(ILcounties)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 8 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -91.51308 ymin: 36.9703 xmax: -88.70541 ymax: 42.49505
## geographic CRS: NAD83
##   GEOID STATEFP COUNTYFP totPop18 hispPr18 WhitePr18 AfrAmPr18 AsianPr18                       geometry
## 1 17001      17      001    66427     1.54     93.06      4.08      0.81 POLYGON ((-91.51297 40.1810...
## 2 17003      17      003     6532     1.12     62.43     33.21      0.09 POLYGON ((-89.51839 37.2893...
## 3 17005      17      005    16712     3.46     90.89      6.24      1.17 POLYGON ((-89.63926 38.9991...
## 4 17007      17      007    53606    21.38     87.42      2.22      1.18 POLYGON ((-88.94098 42.2388...
## 5 17009      17      009     6675     4.28     77.42     20.43      0.55 POLYGON ((-90.91703 39.9022...
## 6 17011      17      011    33381     8.97     93.62      0.93      0.87 POLYGON ((-89.86235 41.584,...</code></pre>
</div>
<div id="TM-mapping" class="section level2">
<h2><span class="header-section-number">4.4</span> Thematic Plotting</h2>
<p>We will be using <code>tmap</code> package for plotting spatial data distributions. The package syntax has similarities with <code>ggplot2</code> and follows the same idea of <em>A Layered Grammar of Graphics</em>.</p>
<ul>
<li>for each input data layer use <code>tm_shape()</code>,</li>
<li>followed by the method to plot it, e.g <code>tm_fill() or tm_dots() or tm_line() or tm_borders()</code> etc.</li>
</ul>
<p>Similar to ggplot2, aesthetics can be provided for each layer and plot layout can be manipulated using <code>tm_layout()</code>. For more details on <code>tmap</code> usage &amp; functionality, check <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">tmap documentation</a>. The previous map we plotted using <code>plot</code> can be mapped using <code>tmap</code> as in the code below.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</a></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span>  <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/quick%20plot%20tmap-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In tmap, the classification scheme is set by the <code>style</code> option in <code>tm_fill()</code> and the default style is <code>pretty</code>. Lets plot the distribution of percentage of hispanic population by county across the state of Illinois with default style using the code below. We can also change the color palette used to depict the spatial distribution. See <a href="visualizeArealData-tutorial.html#TM-set-palette">Set Color Palette</a> in Appendix for more details on that.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Pretty&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>, <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>,</a>
<a class="sourceLine" id="cb60-4" data-line-number="4">          <span class="dt">legend.title.size =</span> <span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb60-5" data-line-number="5">          <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb60-6" data-line-number="6">          <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20pretty-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We will be plotting the spatial distribution of variable hispPr18 for the state of Illinois using three methods.</p>
<ol style="list-style-type: decimal">
<li>Quantile</li>
<li>Natural Breaks</li>
<li>Standard Deviation</li>
</ol>
<p>For detailed documentation on choropleth mapping and methods use check <a href="https://geodacenter.github.io/workbook/3a_mapping/lab3a.html#thematic-maps-overview">GeoDa Center Documentation</a>.</p>
<div id="TM-quantile-plot" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Quantile</h3>
<p>A quantile map is based on sorted values for the variable that are then grouped into bins such that each bin has the same number of observations. It is obtained by setting <code>style = 'quantile'</code> and <code>n = no of bins</code> arguments in tm_fill().</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">p1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Quantile&#39;</span>, </a>
<a class="sourceLine" id="cb61-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>, <span class="dt">n =</span> <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="st">      </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>,<span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb61-4" data-line-number="4">                <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">                <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb61-6" data-line-number="6">                <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb61-7" data-line-number="7"></a>
<a class="sourceLine" id="cb61-8" data-line-number="8"><span class="co">#tmap_save(p1, &#39;PctHisp_18_Quantile.png&#39;) # save the map in a .png file</span></a>
<a class="sourceLine" id="cb61-9" data-line-number="9">p1</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20quantile-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="TM-jenks-plot" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Natural Breaks</h3>
<p>Natural breaks or jenks distribution uses a nonlinear algorithm to cluster data into groups such that the intra-bin similarity is maximized and inter-bin dissimilarity is minimized. It is obtained by setting <code>style = 'jenks'</code> and <code>n = no. of bins</code> in the tm_fill().</p>
<p>As we can see, jenks method better classifies the dataset in review than the quantile distribution. There is no correct method to use and the choice of classification method is dependent on the problem &amp; dataset used.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">p2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Jenks&#39;</span>, </a>
<a class="sourceLine" id="cb62-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;jenks&#39;</span>, <span class="dt">n =</span> <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="st">      </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>,<span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb62-4" data-line-number="4">                <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb62-5" data-line-number="5">                <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb62-6" data-line-number="6">                <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb62-7" data-line-number="7"></a>
<a class="sourceLine" id="cb62-8" data-line-number="8"><span class="co">#tmap_save(p2, &#39;PctHisp_18_Jenks.png&#39;)# save the map in a .png file</span></a>
<a class="sourceLine" id="cb62-9" data-line-number="9">p2</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20jenks-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="TM-stdev-plot" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Standard Deviation</h3>
<p>A standard deviation map normalizes the dataset (mean = 0, stdev = 1) and transforms it into units of stdev (given mean =0). It helps identify outliers in the dataset. It is obtained by setting <code>style = 'sd'</code> in the tm_fill().
The normalization process can create bins with negative values, which in this case don’t necessarily make sense for the dataset, but it still helps identify the outliers.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">p3 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Stdev&#39;</span>, </a>
<a class="sourceLine" id="cb63-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;sd&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="st">      </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>, <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb63-4" data-line-number="4">                <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb63-5" data-line-number="5">                <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb63-6" data-line-number="6">                <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb63-7" data-line-number="7"></a>
<a class="sourceLine" id="cb63-8" data-line-number="8"><span class="co">#tmap_save(p3, &#39;PctHisp_18_Stdev.png&#39;)# save the map in a .png file</span></a>
<a class="sourceLine" id="cb63-9" data-line-number="9">p3</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20stdev-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="TM-appendix" class="section level2">
<h2><span class="header-section-number">4.5</span> Appendix</h2>
<div id="TM-set-palette" class="section level3 unnumbered">
<h3>Set Color Palette</h3>
<p>The range of colors used to depict the distribution in the map can be set by modifying the <code>palette</code> argument in tm_fill(). For example, we can use <code>Blues</code> palette to create the map below.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Jenks&#39;</span>, </a>
<a class="sourceLine" id="cb64-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;jenks&#39;</span>, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">palette =</span> <span class="st">&#39;Blues&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>,<span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb64-4" data-line-number="4">          <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb64-5" data-line-number="5">          <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb64-6" data-line-number="6">          <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20palette-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="TM-colorbrewer" class="section level3 unnumbered">
<h3>Use ColorBrewer</h3>
<p>To build aesthetically pleasing and easy-to-read maps, we recommend using color palette schemes recommended in <a href="https://colorbrewer2.org/#">ColorBrewer 2.0</a> developed by Cynthia Brewer. The website distinguishes between sequential(ordered), diverging(spread around a center) &amp; qualitative(categorical) data. Information on these palettes cab be displayed in R using RColorBrewer package.</p>
<p>We can get the hex values for the colors used in a specific palette with n bins &amp; plot the corresponding colors using code below.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">require</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"></a>
<a class="sourceLine" id="cb65-3" data-line-number="3">RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">5</span>,<span class="st">&quot;PuBuGn&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;#F6EFF7&quot; &quot;#BDC9E1&quot; &quot;#67A9CF&quot; &quot;#1C9099&quot; &quot;#016C59&quot;</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">RColorBrewer<span class="op">::</span><span class="kw">display.brewer.pal</span>(<span class="dv">5</span>,<span class="st">&quot;PuBuGn&quot;</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/colorbrewer-1.png" width="672" /></p>
<p>We can update the jenks map by using this sequential color scheme and changing the transparency using <code>alpha = 0.8</code> as below.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Jenks&#39;</span>, </a>
<a class="sourceLine" id="cb68-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;jenks&#39;</span>, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">palette =</span> <span class="st">&#39;PuBuGn&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb68-3" data-line-number="3"><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">          <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb68-5" data-line-number="5">          <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb68-6" data-line-number="6">          <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20jenks%20improved-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can also update the stdev map by using a diverging color scheme as below.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">tm_shape</span>(ILcounties) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&#39;hispPr18&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;PctHispanic% - Stdev&#39;</span>, </a>
<a class="sourceLine" id="cb69-2" data-line-number="2">                                <span class="dt">style =</span> <span class="st">&#39;sd&#39;</span>, <span class="dt">palette =</span> <span class="st">&#39;-RdBu&#39;</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb69-4" data-line-number="4">          <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>, <span class="dt">legend.outside.position =</span> <span class="st">&#39;right&#39;</span>, <span class="dt">legend.title.size =</span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb69-5" data-line-number="5">          <span class="dt">main.title =</span> <span class="st">&#39;Pct of hispanic population by county, IL 2018&#39;</span>, </a>
<a class="sourceLine" id="cb69-6" data-line-number="6">          <span class="dt">main.title.size =</span> <span class="fl">0.9</span>)</a></code></pre></div>
<p><img src="Opioid-Environment-Toolkit_files/figure-html/plot%20stdev%20improved-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="link-contextual-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="centroid-access-tutorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
